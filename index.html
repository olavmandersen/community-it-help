<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TecIT</title>

  <!-- Link CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <a class="side-logo" href="#" id="reload-logo" aria-label="Reload TecIT site">Tecit.</a>

  <!-- Header / Hero -->
  <header>
    <div class="container">
      <div class="lang-toggle" role="group" aria-label="Language">
        <button class="lang-button" type="button" data-lang="en" aria-pressed="true">English</button>
        <button class="lang-button" type="button" data-lang="no" aria-pressed="false">Norsk</button>
      </div>

      <h1 data-i18n="hero_title">Free IT help — when we’re available.</h1>
      <p class="lead" data-i18n="hero_lead">
        A small, volunteer-based IT help project run by IT students and tech enthusiasts.
      </p>

      <a href="#request" class="button" data-i18n="cta_request">Request help</a>
      <a href="#how" class="button secondary" id="how-button" data-i18n="cta_how">How it works</a>
      <a href="#about" class="button secondary" id="about-button" data-i18n="cta_about">About us</a>

      <div class="live-counter" aria-live="polite">
        <span class="dot" aria-hidden="true"></span>
        <span id="live-count">0</span> online
      </div>
    </div>
  </header>

  <main class="container layout">
    <section id="request" class="primary animate-in">
      <h2 data-i18n="request_title">Request help</h2>
      <p data-i18n="request_lead">
        Fill out the form below. If someone is available and able to help, we’ll get back to you.
      </p>

      <div class="form-wrapper">
        <form id="help-form" class="help-form" autocomplete="on">
          <div class="form-fields">
            <div class="field">
              <label for="name" data-i18n="label_name">Name</label>
              <input id="name" name="name" type="text" autocomplete="name" placeholder="Chuck Norris" required />
            </div>

            <div class="field">
              <label for="email" data-i18n="label_email">Email</label>
              <input id="email" name="email" type="email" autocomplete="email" placeholder="notaborg@skynet.ai" required />
            </div>

            <div class="field">
              <label for="device" data-i18n="label_device">Device / OS</label>
              <input id="device" name="device" type="text" data-i18n-placeholder="placeholder_device" placeholder="e.g., Windows 11 laptop" />
            </div>

            <div class="field">
              <label for="subject" data-i18n="label_subject">Short summary</label>
              <input id="subject" name="subject" type="text" required />
            </div>

            <div class="field">
              <label for="message" data-i18n="label_message">Describe the problem</label>
              <textarea id="message" name="message" rows="6" required></textarea>
            </div>

            <div class="field">
              <label for="urgency" data-i18n="label_urgency">Urgency</label>
              <select id="urgency" name="urgency">
                <option value="low" data-i18n="urgency_low">Low</option>
                <option value="medium" selected data-i18n="urgency_medium">Medium</option>
                <option value="high" data-i18n="urgency_high">High</option>
              </select>
            </div>

            <input class="hp-field" type="text" name="website" tabindex="-1" autocomplete="off" />

            <button class="button" type="submit" data-i18n="submit">Send request</button>
            <p class="form-status" id="form-status" role="status" aria-live="polite"></p>
          </div>

          <div class="form-success" id="form-success" role="status" aria-live="polite" hidden>
            <span data-i18n="success_message">Thanks! Your request was sent. We’ll get back to you as soon as we can.</span>
          </div>
        </form>
      </div>

      <p class="small" data-i18n="request_note">
        Requests are visible to multiple volunteers working on this project.
      </p>
    </section>

    <aside class="sidebar">
      <h3 class="sidebar-title" data-i18n="learn_more">Learn more</h3>

      <!-- What this is -->
      <section class="collapsible-section">
        <details class="collapsible">
          <summary data-i18n="what_title">What this is</summary>
          <div class="collapsible-content">
            <div class="card">
            <p data-i18n="what_body">
              We help with everyday technical problems when we have the time.
              This project is volunteer-based and run in our spare time.
            </p>
            <ul>
              <li data-i18n="what_item1">Wi-Fi and home network issues</li>
              <li data-i18n="what_item2">Windows and macOS problems</li>
              <li data-i18n="what_item3">Basic cybersecurity questions</li>
            </ul>
            </div>
          </div>
        </details>
      </section>

      <!-- How it works -->
      <section id="how" class="collapsible-section">
        <details class="collapsible" id="how-details">
          <summary data-i18n="how_title">How it works</summary>
          <div class="collapsible-content">
            <div class="card">
            <ol>
              <li data-i18n="how_step1">You submit a request</li>
              <li data-i18n="how_step2">We review it when available</li>
              <li data-i18n="how_step3">If someone can help, we’ll get in touch</li>
            </ol>
            </div>
          </div>
        </details>
      </section>

      <!-- What to expect -->
      <section class="collapsible-section">
        <details class="collapsible">
          <summary data-i18n="expect_title">What to expect</summary>
          <div class="collapsible-content">
            <div class="notice" data-i18n="expect_body">
            Help is provided by volunteers in their spare time and offered on a best-effort basis.
            We can’t guarantee fast responses or solutions to all problems.
            </div>
          </div>
        </details>
      </section>

      <!-- When should you use this -->
      <section class="collapsible-section">
        <details class="collapsible">
          <summary data-i18n="when_title">When is this right for you?</summary>
          <div class="collapsible-content">
            <div class="card">
            <p data-i18n="when_body">
              This service is best suited when you're stuck with a specific technical problem
              and can’t quite solve it on your own.
            </p>
          
            <ul>
              <li data-i18n="when_item1">You have an issue with your PC, network, or software and can’t find a clear solution</li>
              <li data-i18n="when_item2">You’re getting error messages or strange behavior that doesn’t make sense</li>
              <li data-i18n="when_item3">You’re unsure what is actually safe to do</li>
              <li data-i18n="when_item4">You want help before doing something that might break or delete something important</li>
              <li data-i18n="when_item5">You need someone to look at your specific situation</li>
            </ul>
            </div>
          </div>
        </details>
      </section>

      <!-- About us -->
      <section id="about" class="collapsible-section">
        <details class="collapsible" id="about-details">
          <summary data-i18n="about_title">About us</summary>
          <div class="collapsible-content">
            <div class="card">
            <p data-i18n="about_p1">
              We’re a small group of IT professionals and tech enthusiasts who enjoy troubleshooting
              and helping people solve everyday technical problems.
            </p>

            <p data-i18n="about_p2">
              Our background includes a Bachelor’s degree in Cybersecurity, completed through
              the University of South Wales (USW) and Noroff.
            </p>

            <p data-i18n="about_p3">
              This project is run in our spare time and is completely volunteer-based.
              We help when we’re available and only with what we can reasonably handle.
            </p>
            </div>
          </div>
        </details>
      </section>
    </aside>
  </main>

  <section class="container terms" aria-labelledby="terms-title">
    <div class="terms-header">
      <h3 id="terms-title" data-i18n="terms_title">Terms & Service</h3>
      <span class="terms-badge" data-i18n="terms_badge">Important</span>
    </div>
    <div class="terms-card">
      <p data-i18n="terms_p1">
        This is a volunteer service. Help is provided as‑is, without guarantees or liability.
        We won’t ask for passwords, and you should never share sensitive data.
        We may decline requests we can’t safely handle.
      </p>
      <p data-i18n="terms_p2">
        We care about privacy and security. We follow GDPR principles, collect only what’s needed,
        use TLS to protect data in transit, and handle information responsibly.
      </p>
    </div>
    <details class="collapsible terms-collapsible">
      <summary data-i18n="delete_title">Delete my data</summary>
      <div class="collapsible-content">
        <div class="terms-card">
          <p data-i18n="delete_lead">
            Use this quick form if you want us to remove your data from our system.
          </p>
          <p class="small" data-i18n="delete_data_note">
            We only store the information you submit in the help form (name, email, device, subject, message, urgency).
          </p>
          <form id="delete-form" class="help-form compact-form" autocomplete="on">
            <div class="field">
              <label for="delete-email" data-i18n="delete_email">Email</label>
              <input id="delete-email" name="email" type="email" autocomplete="email" required />
            </div>
            <div class="field">
              <label for="delete-type" data-i18n="delete_type">What should we delete?</label>
              <select id="delete-type" name="type" required>
                <option value="all" data-i18n="delete_opt_all">All data about me</option>
                <option value="requests" data-i18n="delete_opt_requests">Help requests</option>
                <option value="messages" data-i18n="delete_opt_messages">Messages / notes</option>
              </select>
            </div>
            <button class="button secondary" type="submit" data-i18n="delete_submit">Send delete request</button>
            <p class="form-status" id="delete-status" role="status" aria-live="polite"></p>
          </form>
        </div>
      </div>
    </details>
  </section>

  <!-- Footer -->
  <footer data-i18n="footer_text">
    TecIT · Volunteer-based · Low‑barrier help
  </footer>

  <script>
    const aboutDetails = document.getElementById("about-details");
    const aboutButton = document.getElementById("about-button");
    const howDetails = document.getElementById("how-details");
    const howButton = document.getElementById("how-button");
    const reloadLogo = document.getElementById("reload-logo");
    const langButtons = document.querySelectorAll(".lang-button");
    const openTargetDetails = () => {
      if (window.location.hash === "#about" && aboutDetails) {
        aboutDetails.open = true;
      }
    };

    const initCollapsibles = () => {
      document.querySelectorAll(".collapsible").forEach((details) => {
        const content = details.querySelector(".collapsible-content");
        const summary = details.querySelector("summary");
        if (!content) return;

        const setHeight = (isOpen) => {
          content.style.maxHeight = isOpen ? `${content.scrollHeight}px` : "0px";
        };

        setHeight(details.open);
        details.addEventListener("toggle", () => {
          if (details.open) setHeight(true);
        });
        if (summary) {
          summary.addEventListener("click", (event) => {
            if (!details.open) return;
            event.preventDefault();
            details.classList.add("is-closing");
            setHeight(true);
            requestAnimationFrame(() => {
              content.style.maxHeight = "0px";
              content.style.opacity = "0";
              content.style.transform = "translateY(-6px)";
            });
            const onEnd = (e) => {
              if (e.propertyName !== "max-height") return;
              details.open = false;
              details.classList.remove("is-closing");
              content.style.opacity = "";
              content.style.transform = "";
              content.removeEventListener("transitionend", onEnd);
            };
            content.addEventListener("transitionend", onEnd);
          });
        }
        window.addEventListener("resize", () => {
          if (details.open) setHeight(true);
        });
      });
    };

    window.addEventListener("hashchange", openTargetDetails);
    if (aboutButton) {
      aboutButton.addEventListener("click", () => {
        if (aboutDetails) aboutDetails.open = true;
      });
    }
    if (howButton) {
      howButton.addEventListener("click", () => {
        if (howDetails) howDetails.open = true;
      });
    }
    if (reloadLogo) {
      reloadLogo.addEventListener("click", (event) => {
        event.preventDefault();
        window.location.reload();
      });
    }
    window.addEventListener("load", () => {
      initCollapsibles();
      openTargetDetails();
    });

    const translations = {
      en: {
        hero_title: "Free IT help — when we’re available.",
        hero_lead:
          "A small, volunteer-based IT help project run by IT students and tech enthusiasts.",
        cta_request: "Request help",
        cta_how: "How it works",
        cta_about: "About us",
        request_title: "Request help",
        request_lead:
          "Fill out the form below. If someone is available and able to help, we’ll get back to you.",
        label_name: "Name",
        label_email: "Email",
        label_device: "Device / OS",
        placeholder_device: "e.g., Windows 11 laptop",
        label_subject: "Short summary",
        label_message: "Describe the problem",
        label_urgency: "Urgency",
        urgency_low: "Low",
        urgency_medium: "Medium",
        urgency_high: "High",
        submit: "Send request",
        success_message:
          "Thanks! Your request was sent. We’ll get back to you as soon as we can.",
        request_note:
          "Requests are visible to multiple volunteers working on this project.",
        learn_more: "Learn more",
        what_title: "What this is",
        what_body:
          "We help with everyday technical problems when we have the time. This project is volunteer-based and run in our spare time.",
        what_item1: "Wi-Fi and home network issues",
        what_item2: "Windows and macOS problems",
        what_item3: "Basic cybersecurity questions",
        how_title: "How it works",
        how_step1: "You submit a request",
        how_step2: "We review it when available",
        how_step3: "If someone can help, we’ll get in touch",
        expect_title: "What to expect",
        expect_body:
          "Help is provided by volunteers in their spare time and offered on a best-effort basis. We can’t guarantee fast responses or solutions to all problems.",
        when_title: "When is this right for you?",
        when_body:
          "This service is best suited when you're stuck with a specific technical problem and can’t quite solve it on your own.",
        when_item1:
          "You have an issue with your PC, network, or software and can’t find a clear solution",
        when_item2:
          "You’re getting error messages or strange behavior that doesn’t make sense",
        when_item3: "You’re unsure what is actually safe to do",
        when_item4:
          "You want help before doing something that might break or delete something important",
        when_item5: "You need someone to look at your specific situation",
        about_title: "About us",
        about_p1:
          "We’re a small group of IT professionals and tech enthusiasts who enjoy troubleshooting and helping people solve everyday technical problems.",
        about_p2:
          "Our background includes a Bachelor’s degree in Cybersecurity, completed through the University of South Wales (USW) and Noroff.",
        about_p3:
          "This project is run in our spare time and is completely volunteer-based. We help when we’re available and only with what we can reasonably handle.",
        footer_text: "TecIT · Volunteer-based · Low‑barrier help",
        terms_title: "Terms & Service",
        terms_badge: "Important",
        terms_p1:
          "This is a volunteer service. Help is provided as‑is, without guarantees or liability. We won’t ask for passwords, and you should never share sensitive data. We may decline requests we can’t safely handle.",
        terms_p2:
          "We care about privacy and security. We follow GDPR principles, collect only what’s needed, use TLS to protect data in transit, and handle information responsibly.",
        delete_title: "Delete my data",
        delete_badge: "Privacy",
        delete_lead:
          "Use this quick form if you want us to remove your data from our system.",
        delete_data_note:
          "We only store the information you submit in the help form (name, email, device, subject, message, urgency).",
        delete_email: "Email",
        delete_type: "What should we delete?",
        delete_opt_all: "All data about me",
        delete_opt_requests: "Help requests",
        delete_opt_messages: "Messages / notes",
        delete_submit: "Send delete request",
        delete_sending: "Sending...",
        delete_error: "Something went wrong. Try again.",
        delete_success: "Request received. We’ll process it soon.",
      },
      no: {
        hero_title: "Gratis IT-hjelp — når vi har tid.",
        hero_lead:
          "Et lite, frivillig IT-hjelpeprosjekt drevet av IT-studenter og teknologientusiaster.",
        cta_request: "Be om hjelp",
        cta_how: "Slik fungerer det",
        cta_about: "Om oss",
        request_title: "Be om hjelp",
        request_lead:
          "Fyll ut skjemaet under. Hvis noen er tilgjengelige og kan hjelpe, tar vi kontakt.",
        label_name: "Navn",
        label_email: "E-post",
        label_device: "Enhet / OS",
        placeholder_device: "f.eks. Windows 11‑laptop",
        label_subject: "Kort oppsummering",
        label_message: "Beskriv problemet",
        label_urgency: "Haster",
        urgency_low: "Lav",
        urgency_medium: "Middels",
        urgency_high: "Høy",
        submit: "Send forespørsel",
        success_message:
          "Takk! Forespørselen er sendt. Vi tar kontakt så snart vi kan.",
        request_note:
          "Forespørsler er synlige for flere frivillige som jobber på dette prosjektet.",
        learn_more: "Les mer",
        what_title: "Hva dette er",
        what_body:
          "Vi hjelper med hverdagslige tekniske problemer når vi har tid. Prosjektet er frivillig og drives på fritiden.",
        what_item1: "Wi‑Fi og hjemmenettverksproblemer",
        what_item2: "Windows- og macOS-problemer",
        what_item3: "Grunnleggende cybersikkerhetsspørsmål",
        how_title: "Slik fungerer det",
        how_step1: "Du sender inn en forespørsel",
        how_step2: "Vi vurderer når vi har tid",
        how_step3: "Hvis noen kan hjelpe, tar vi kontakt",
        expect_title: "Hva du kan forvente",
        expect_body:
          "Hjelp gis av frivillige på fritiden og på best‑effort‑basis. Vi kan ikke garantere raske svar eller løsninger.",
        when_title: "Når passer dette for deg?",
        when_body:
          "Tjenesten passer best når du sitter fast med et konkret teknisk problem og ikke finner en god løsning.",
        when_item1:
          "Du har problemer med PC, nettverk eller programvare uten å finne en klar løsning",
        when_item2:
          "Du får feilmeldinger eller rar oppførsel som ikke gir mening",
        when_item3: "Du er usikker på hva som er trygt å gjøre",
        when_item4:
          "Du vil ha hjelp før du gjør noe som kan ødelegge eller slette noe viktig",
        when_item5: "Du trenger noen som ser på situasjonen din",
        about_title: "Om oss",
        about_p1:
          "Vi er en liten gruppe IT‑folk og teknologientusiaster som liker å feilsøke og hjelpe med hverdagslige tekniske problemer.",
        about_p2:
          "Bakgrunnen vår inkluderer en bachelorgrad i cybersikkerhet fra University of South Wales (USW) og Noroff.",
        about_p3:
          "Prosjektet drives på fritiden og er helt frivillig. Vi hjelper når vi har mulighet og med det vi kan håndtere.",
        footer_text: "TecIT · Frivillig · Lavterskel hjelp",
        terms_title: "Vilkår og tjenester",
        terms_badge: "Viktig",
        terms_p1:
          "Dette er en frivillig tjeneste. Hjelp gis som den er, uten garantier eller ansvar. Vi ber aldri om passord, og du skal aldri dele sensitiv informasjon. Vi kan avslå forespørsler vi ikke kan håndtere trygt.",
        terms_p2:
          "Vi bryr oss om personvern og sikkerhet. Vi følger GDPR‑prinsipper, samler inn kun det som er nødvendig, bruker TLS for å beskytte data under overføring og håndterer informasjon ansvarlig.",
        delete_title: "Slett mine data",
        delete_badge: "Personvern",
        delete_lead:
          "Bruk dette korte skjemaet hvis du vil at vi skal fjerne dataene dine.",
        delete_data_note:
          "Vi lagrer kun informasjonen du sender inn i hjelpeskjemaet (navn, e‑post, enhet, emne, melding, hast).",
        delete_email: "E‑post",
        delete_type: "Hva skal vi slette?",
        delete_opt_all: "All data om meg",
        delete_opt_requests: "Hjelpeforespørsler",
        delete_opt_messages: "Meldinger / notater",
        delete_submit: "Send sletteforespørsel",
        delete_sending: "Sender...",
        delete_error: "Noe gikk galt. Prøv igjen.",
        delete_success: "Forespørsel mottatt. Vi behandler den snart.",
      },
    };

    const applyLanguage = (lang) => {
      const dict = translations[lang] || translations.en;
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        if (!dict[key]) return;
        el.textContent = dict[key];
      });
      document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
        const key = el.getAttribute("data-i18n-placeholder");
        if (!dict[key]) return;
        el.setAttribute("placeholder", dict[key]);
      });
      langButtons.forEach((btn) => {
        const isActive = btn.dataset.lang === lang;
        btn.setAttribute("aria-pressed", String(isActive));
        btn.classList.toggle("active", isActive);
      });
      document.documentElement.lang = lang === "no" ? "no" : "en";
      localStorage.setItem("site_lang", lang);
    };

    const savedLang = localStorage.getItem("site_lang");
    const browserLang = navigator.language && navigator.language.startsWith("no") ? "no" : "en";
    applyLanguage(savedLang || browserLang);

    langButtons.forEach((btn) => {
      btn.addEventListener("click", () => applyLanguage(btn.dataset.lang));
    });
  </script>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const SUPABASE_URL = "https://sqrnuydahsdbdftgghtf.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxcm51eWRhaHNkYmRmdGdnaHRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NzQ3MjUsImV4cCI6MjA4NTI1MDcyNX0.o95HOLYf6D21E_pd9T6zJ0jr9iGubpisEaeQdYJZjFE";

    const countEl = document.getElementById("live-count");
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const NOTIFY_FUNCTION_NAME = "notify-help-request";
    const CONTACT_FORM_TOKEN = "07a129bf26f76ec0eb5021fe96c8f71679c2bcba49048253636117476f10bd7d";
    console.log("MODULE LOADED ✅ token start:", CONTACT_FORM_TOKEN.slice(0, 8));

    const sessionId =
      (crypto.randomUUID && crypto.randomUUID()) ||
      `${Date.now()}-${Math.random().toString(16).slice(2)}`;

    const channel = supabase.channel("online-users", {
      config: { presence: { key: sessionId } },
    });

    const updateCount = () => {
      const state = channel.presenceState();
      const count = Object.keys(state).length;
      if (countEl) countEl.textContent = String(count);
    };

    channel.on("presence", { event: "sync" }, updateCount);

    channel.subscribe(async (status) => {
      if (status !== "SUBSCRIBED") return;
      await channel.track({ online_at: new Date().toISOString() });
      updateCount();
    });

    window.addEventListener("beforeunload", () => {
      channel.untrack();
    });

    const form = document.getElementById("help-form");
    const statusEl = document.getElementById("form-status");
    const successEl = document.getElementById("form-success");
    const deleteForm = document.getElementById("delete-form");
    const deleteStatus = document.getElementById("delete-status");
    if (form) {
      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        if (successEl) successEl.hidden = true;
        if (statusEl) statusEl.textContent = "Sending...";

        const data = new FormData(form);
        if (data.get("website")) {
          if (statusEl) statusEl.textContent = "Thanks!";
          form.reset();
          return;
        }

        const payload = {
          name: data.get("name"),
          email: data.get("email"),
          device: data.get("device"),
          subject: data.get("subject"),
          message: data.get("message"),
          urgency: data.get("urgency"),
        };

        const { error } = await supabase.from("help_requests").insert(payload);
        if (error) {
          if (statusEl) statusEl.textContent = "Something went wrong. Try again.";
          return;
        }

        if (statusEl) statusEl.textContent = "";
        if (successEl) successEl.hidden = false;
        form.classList.add("submitted");
        if (successEl) {
          successEl.scrollIntoView({ behavior: "smooth", block: "center" });
        }

        if (NOTIFY_FUNCTION_NAME) {
          console.log("Calling notify function…", {
            fn: NOTIFY_FUNCTION_NAME,
            tokenStart: CONTACT_FORM_TOKEN.slice(0, 8),
          });

          const { data, error } = await supabase.functions.invoke(NOTIFY_FUNCTION_NAME, {
            headers: { "X-Form-Token": CONTACT_FORM_TOKEN },
            body: payload,
          });

          console.log("Notify response:", { data, error });

          if (error) {
            if (statusEl) statusEl.textContent = "Saved, but notify failed. Check console.";
            return;
          }
        }
      });
    }

    if (deleteForm) {
      deleteForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        if (deleteStatus) deleteStatus.textContent = translations[document.documentElement.lang]?.delete_sending || "Sending...";

        const data = new FormData(deleteForm);
        const payload = {
          email: data.get("email"),
          type: data.get("type"),
        };

        const { error } = await supabase.from("delete_requests").insert(payload);
        if (error) {
          if (deleteStatus) deleteStatus.textContent = translations[document.documentElement.lang]?.delete_error || "Something went wrong. Try again.";
          return;
        }

        if (deleteStatus) deleteStatus.textContent = translations[document.documentElement.lang]?.delete_success || "Request received. We’ll process it soon.";
        deleteForm.reset();
      });
    }
  </script>

</body>
</html>
